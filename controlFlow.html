<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type='text/javascript' src='knockout-3.5.1.js'></script>
    <title>Поток управления</title>
</head>
<body>
    <!--
    //Итерация по массиву
        <div>
        <table>
            <thead>
                <tr>
                    <th>First name</th>
                    <th>Last name</th>
                </tr>
            </thead>
            <tbody data-bind="foreach: people">
                <tr>
                    <td data-bind="text: firstName"></td>
                    <td data-bind="text: lastName"></td>
                </tr>
            </tbody>
        </table>
    </div>
-->
<!--Пример с +- -->
    <div>
        <h4>Список гостей</h4>
        <ul data-bind="foreach: people">
            <li>
                Человек под номером <span data-bind="text: $index"></span>:
                <span data-bind="text: name"></span>
                <a href="#" data-bind="click: $parent.removePerson">Удалить</a>
            </li>
        </ul>
        <button data-bind="click: addPerson">Добавить</button>
    </div>
    <div>
        <ul data-bind="foreach: months">
            <li>
                По порядку рассчитайсь:<b data-bind="text: $index"></b> <b data-bind="text: $data"></b>
            </li>
        </ul>
    </div>
    <div>
        <h1 data-bind="text: blogPostTitle"></h1>
        <ul data-bind="foreach: likes">
            <li>
                <b data-bind="text: $parent.blogPostTitle"></b> понравился:  <b data-bind="text: $index"></b>
            </li>
        </ul>
    </div>
    <div>
        <ul data-bind="foreach: { data: categories, as: 'category' }">
            <li>
                <ul data-bind="foreach: { data: items, as: 'item' }">
                    <li>
                        <span data-bind="text: category.name"></span>:
                        <span data-bind="text: item"></span>
                    </li>
                </ul>
            </li>
        </ul>        
    </div>
    <div>
        <ul data-bind="foreach: { data: categories, as: 'category', noChildContext: true }">
            <li>
                <ul data-bind="foreach: { data: category.items, as: 'item', noChildContext: true }">
                    <li>
                        <span data-bind="text: category.name"></span>:
                        <span data-bind="text: item"></span>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <div>
        <ul>
            <li class="header">Заголовок</li>
            <!-- ko foreach: myItems -->
                <li>Элемент <span data-bind="text: $data"></span></li>
            <!-- /ko -->
            <!--
                Комментарии  ko и /ko действуют как маркеры начала/конца, 
                определяя «виртуальный элемент», который содержит разметку внутри. 
                Knockout понимает синтаксис этого виртуального элемента и выполняет привязку,
                 как если бы у вас был настоящий элемент-контейнер.
            -->
        </ul>
    </div>
    <div>
        <label><input type="checkbox" data-bind="checked: displayMessage">Показать сообщение</label>
        <div data-bind="if: displayMessage">Сообщение</div>
    </div>
    <div>
        <ul data-bind="foreach: planets">
            <li>
                Планета: <b data-bind="text: name"> </b>
                <div data-bind="if: capital">
                    Столица: <b data-bind="text: capital.cityName"> </b>
                </div>
            </li>
        </ul>        
    </div>
    <div>
        <ul>
            <li>Вывод без контейнера</li>
            <li>И без потока управления</li>
        </ul>
    </div>
    <div>
        <ul>
            <li>Вывод без контейнера. Но с потоком управления и с привязкой к if</li>
            <!-- ko ifnot: someExpressionGoesHere -->
            <li>I want to make this item present/absent dynamically</li>
            <!-- /ko -->
        </ul>
    </div>
    <div>
        <h1 data-bind="text: city"> </h1>
        <p data-bind="using: coords">
            Широта: <span data-bind="text: latitude"> </span>,
            Долгота: <span data-bind="text: longitude"> </span>
        </p>
    </div>
    <div>
        <form data-bind="submit: getTweets">
            Twitter аккаунт:
            <input data-bind="value: twitterName" />
            <button type="submit">Получит твит</button>
        </form>         
        <div data-bind="with: resultData">
            <h3>Последние твиты, полученные по адресу <span data-bind="text: retrievalDate"> </span></h3>
            <ol data-bind="foreach: topTweets">
                <li data-bind="text: text"></li>
            </ol>         
            <button data-bind="click: $parent.clearResults">Очистить твиты</button>
        </div>
    </div>
    
    <div>
    <!-- ko let: {inventory: {suppliers: suppliers, bins: bins}, calculatedDisplay: someCalculation} -->
        <div data-bind="foreach: {data: inventory.suppliers, as: 'supplier'}">
            <div data-bind="foreach: {data: inventory.bins, as: 'bin'}">
                <span data-bind="text: calculatedDisplay(supplier, bin)">
            </div>
        </div>
    <!-- /ko -->
    </div>

    <script>        
    /*
    //Итерация по массиву
        var viewModel={
            people: [
                { firstName: 'Bert', lastName: 'Bertington' },
                { firstName: 'Charles', lastName: 'Charlesforth' },
                { firstName: 'Denise', lastName: 'Dentiste' }
            ]
        }  
        ko.applyBindings(viewModel);
    */

    //Пример с +-
        function AppViewModel(){
            var self = this;
            self.likes = ko.observableArray([
                'Arri','Marry','Karry'
            ]);
            self.myItems =ko.observableArray([ 'A', 'B', 'C' ]);
            self.blogPostTitle = ko.observable("Новый-новый-мега-крутой-пост")
            self.people = ko.observableArray([
                {name:'Анна'},
                {name:'Вика'},
                {name:'Ника'}
            ]);
            self.months = ko.observableArray([
                'Январь','Февраль','Март','Апрель','и тд'
            ]);
            self.addPerson = function() {
                self.people.push({ name: "Добавлен в " + new Date() });
            };
            self.removePerson = function(){
                self.people.remove(this);
            };
            self.categories = ko.observableArray([
                { name: 'Фрукты', items: [ 'Яблоко', 'Апельсин', 'Банан' ] },
                { name: 'Овощи', items: [ 'Огурец', 'Морковка', 'Помидор' ] }
            ]);
            self.displayMessage = ko.observable(false);
            self.planets = ko.observableArray([
                { name: 'Меркурий', capital: null }, 
                { name: 'Земля', capital: { cityName: 'ост. Пате' } }        
            ]);
            self.someExpressionGoesHere = ko.observable(false);
            //using
            self.city = ko.observable("Лондон");
            self.coords = ko.observable({
                latitude:  51.5001524,
                longitude: -0.1262362
            });
            //with
            self.twitterName = ko.observable('@example');
            self.resultData = ko.observable();
            self.getTweets = function(){
                var name = self.twitterName(),
                simulatedResults = [
                    {text: name + ' Какой хороший день'},
                    {text: name + 'Кофе на берегу'},
                    {text: name + 'Медитация - моя любовь'}
                ];
                self.resultData({
                    retrievalDate: new Date(), topTweets: simulatedResults
                });
            };
            self.clearResults = function() {
                self.resultData(undefined);
            };

            //let - ?????
            self.suppliers = ko.observableArray(['a','b','c']);
            self.bins = ko.observableArray(['s','f','t']);
            self.someCalculation = ko.observable(function(supplier, bin) {
                console.log(supplier);
            });
        };

        ko.applyBindings(new AppViewModel());
        
        
    </script>
</body>
</html>
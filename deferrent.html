<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type='text/javascript' src='knockout-3.5.1.js'></script>
    <script type='text/javascript' src='jquery-2.1.1.js'></script>
   
    <title>Отложенные обновления</title>
</head>
<body>
  <!--ko foreach: $root-->
    <div class="example">
        <table>
            <tbody data-bind='foreach: data'>
                <tr>
                    <td data-bind="text: name"></td>
                    <td data-bind="text: position"></td>
                    <td data-bind="text: location"></td>
                </tr>
            </tbody>
        </table>
        <button data-bind="click: flipData, text: 'Щелкнуть ' + type"></button>
        <div class="time" data-bind="text: (data(), timing() + ' мс')"></div>
    </div>
    <!--/ko-->

    <script>
        function GridViewModel() {
            this.pageSize = ko.observable(20);
            this.pageIndex = ko.observable(1);
            this.currentPageData = ko.observableArray();
            this.setPageSize = function(newPageSize) {
                // сбросить индекс страницы на 1 при изменении
                this.pageSize(newPageSize);
                this.pageIndex(1);
            }

            //использовать результаты для обновления
            ko.computed(function() {
                // оценка
                var params = { page: this.pageIndex(), size: this.pageSize() };
                $.getJSON('/Some/Json/Service', params, this.currentPageData);
            }, this).extend({ deferred: true });
        }
        function AppViewModel(type) {
            this.type = type;
            this.data = ko.observableArray().extend({ deferred: true });
            this.data = ko.observableArray([
                { name: 'Алиса', position: 'Батлер', location: 'Лондон' },
                { name: 'Мария', position: 'Шерман', location: 'Нью-Йорк' }
            ]);
            this.flipData = function () {
                this.starttime = new Date().getTime();
                var data = this.data();
                for (var i = 0; i < 999; i++) {
                    this.data([]);
                    this.data(data.reverse());
                }
            }
            this.timing = function () {
                return this.starttime ? new Date().getTime() - this.starttime : 0;
            };
        }
        
        ko.options.deferUpdates = true;
        var vmDeferred = new AppViewModel('Отложить');
        
        ko.options.deferUpdates = false;
        var vmStandard = new AppViewModel('Стандарт');
        
        ko.applyBindings([vmStandard, vmDeferred]);
    </script>    
</body>
</html>